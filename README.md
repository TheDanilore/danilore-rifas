# üéØ Danilore Rifas - Sistema de Rifas Online

Sistema completo de rifas online con **premios progresivos** usando Laravel + Vue.js + MySQL con Docker.

## üìã Descripci√≥n del Sistema

**Danilore Rifas** es una plataforma de rifas online con un innovador sistema de **premios progresivos** donde los usuarios pueden desbloquear diferentes premios a medida que se venden m√°s tickets. Cada rifa puede tener m√∫ltiples premios con niveles que se van desbloqueando progresivamente.

### üéÆ Caracter√≠sticas Principales

- **Sistema de Premios Progresivos**: Los premios se desbloquean seg√∫n la cantidad de tickets vendidos
- **Niveles por Premio**: Cada premio tiene niveles que se van completando gradualmente
- **Galer√≠a Multimedia**: Soporte para im√°genes y videos de alta calidad
- **Pagos Integrados**: Yape, Plin, transferencias bancarias
- **Dashboard Administrativo**: Panel completo para gesti√≥n de rifas
- **Notificaciones en Tiempo Real**: Email, SMS y WhatsApp
- **Sistema de Auditor√≠a**: Registro completo de todas las acciones
- **Autenticaci√≥n JWT**: Laravel Sanctum para seguridad API
- **Panel Admin Completo**: Gesti√≥n de rifas, usuarios, ventas y reportes
- **Responsive Design**: Optimizado para desktop, tablet y m√≥vil


## **Sistema de Premios Multinivel:**

1. **Rifa Principal**¬†‚Üí Tiene m√∫ltiples premios que se desbloquean progresivamente
2. **Cada Premio**¬†‚Üí Tiene sus propios niveles (1, 2, 3, etc.)
3. **Al completar todos los niveles de un premio**¬†‚Üí Se desbloquea el siguiente premio
4. **Cada nuevo premio desbloqueado**¬†‚Üí Tiene sus propios niveles desde cero


## üéÆ C√≥mo Funciona el Sistema

### **Concepto de Premios Progresivos**

El sistema funciona con un **modelo de premios progresivos** donde:

1. **Una rifa tiene m√∫ltiples premios** (Ej: p1, p2, p3)
2. **Cada premio tiene m√∫ltiples niveles** (Ej: n1, n2, n3)
3. **Los premios se desbloquean secuencialmente** seg√∫n los tickets vendidos
4. **Los niveles dentro de un premio se completan gradualmente**

### **Ejemplo Pr√°ctico: Rifa PlayStation 5**

```
üé∞ RIFA: PlayStation 5 y Accesorios
‚îú‚îÄ‚îÄ üèÜ Premio 1: Accesorios Gaming (p1)
‚îÇ   ‚îú‚îÄ‚îÄ üì¶ Nivel 1: Auriculares Gaming (20 tickets)
‚îÇ   ‚îî‚îÄ‚îÄ üì¶ Nivel 2: Control Adicional (30 tickets)
‚îú‚îÄ‚îÄ üèÜ Premio 2: Juegos Exclusivos (p2) [Requiere p1 completado]
‚îÇ   ‚îú‚îÄ‚îÄ üì¶ Nivel 1: God of War (40 tickets)
‚îÇ   ‚îú‚îÄ‚îÄ üì¶ Nivel 2: Spider-Man 2 (50 tickets)
‚îÇ   ‚îî‚îÄ‚îÄ üì¶ Nivel 3: The Last of Us (60 tickets)
‚îî‚îÄ‚îÄ üèÜ Premio 3: PlayStation 5 Console (p3) [Requiere p2 completado]
    ‚îú‚îÄ‚îÄ üì¶ Nivel 1: Console Est√°ndar (70 tickets)
    ‚îî‚îÄ‚îÄ üì¶ Nivel 2: Bundle Completo (75 tickets)
```

### **Flujo de Desbloqueo**

1. **0-19 tickets**: Todos los premios bloqueados
2. **20 tickets**: Se desbloquea Auriculares Gaming (p1-n1)
3. **30 tickets**: Se completa Control Adicional (p1-n2) ‚Üí Premio 1 completado
4. **40 tickets**: Se desbloquea God of War (p2-n1)
5. **50 tickets**: Se desbloquea Spider-Man 2 (p2-n2)
6. **60 tickets**: Se completa The Last of Us (p2-n3) ‚Üí Premio 2 completado
7. **70 tickets**: Se desbloquea PlayStation 5 (p3-n1)
8. **75 tickets**: Se completa Bundle Completo (p3-n2) ‚Üí **RIFA CONFIRMADA**


## üóÑÔ∏è Estructura de la Base de Datos

### ÔøΩ **Tipos de Documento Soportados**

El sistema soporta m√∫ltiples tipos de documentos para hacerlo internacional y flexible:

- **DNI**: Documento Nacional de Identidad (Per√∫) - 8 d√≠gitos
- **CE**: Carn√© de Extranjer√≠a (Per√∫) - Hasta 20 caracteres
- **Passport**: Pasaporte internacional - Hasta 20 caracteres  
- **RUC**: Registro √önico de Contribuyentes (empresas) - 11 d√≠gitos
- **Otros**: Otros tipos de documento no especificados

### ÔøΩüë§ **Tabla: `users`**
```sql
- id (BIGINT, PK)
- name (VARCHAR)
- email (VARCHAR, UNIQUE)
- password (VARCHAR)
- telefono (VARCHAR, 15)
- tipo_documento (ENUM: dni, ce, passport, ruc, otros) DEFAULT 'dni'
- numero_documento (VARCHAR, 20)
- fecha_nacimiento (DATE)
- genero (ENUM: masculino, femenino, otro)
- direccion (VARCHAR)
- ciudad (VARCHAR, 100)
- departamento (VARCHAR, 100)
- codigo_postal (VARCHAR, 10)
- rol (ENUM: admin, usuario) DEFAULT 'usuario'
- activo (BOOLEAN) DEFAULT true
- ultimo_acceso (DATETIME)
- avatar (VARCHAR)
- notif_email (BOOLEAN) DEFAULT true
- notif_sms (BOOLEAN) DEFAULT false
- notif_whatsapp (BOOLEAN) DEFAULT true
- total_boletos_comprados (INT) DEFAULT 0
- total_gastado (DECIMAL 12,2) DEFAULT 0
- rifas_ganadas (INT) DEFAULT 0
- timestamps
```

### üé∞ **Tabla: `rifas`**
```sql
- id (BIGINT, PK)
- titulo (VARCHAR)
- descripcion (TEXT)
- precio_boleto (DECIMAL 10,2)
- boletos_minimos (INT) # Tickets m√≠nimos para confirmar la rifa
- boletos_maximos (INT) # Tickets m√°ximos (null = sin l√≠mite)
- boletos_vendidos (INT) DEFAULT 0
- imagen_principal (VARCHAR)
- imagenes_adicionales (JSON)
- media_gallery (JSON) # M√∫ltiples medios
- fecha_inicio (DATE)
- fecha_fin (DATE)
- fecha_sorteo (DATETIME)
- estado (ENUM: borrador,activa,bloqueada,pausada,finalizada,cancelada) DEFAULT 'borrador'
- tipo (ENUM: actual, futura) DEFAULT 'futura'
- categoria_id (BIGINT, FK)
- codigo_unico (VARCHAR, 20, UNIQUE)
- es_destacada (BOOLEAN) DEFAULT false
- max_boletos_por_persona (INT) DEFAULT 10
- terminos_condiciones (TEXT)
- orden (INT) DEFAULT 1 # Para ordenar rifas futuras
- rifa_requerida_id (BIGINT, FK) # Rifa que debe completarse antes
- notas_admin (TEXT)
- timestamps
```

### üèÜ **Tabla: `premios`**
```sql
- id (BIGINT, PK)
- rifa_id (BIGINT, FK)
- codigo (VARCHAR, 10) # p1, p2, p3, etc.
- titulo (VARCHAR)
- descripcion (TEXT)
- imagen_principal (VARCHAR)
- media_gallery (JSON) # Im√°genes y videos adicionales
- orden (INT) # Orden del premio (1, 2, 3...)
- premio_requerido_id (BIGINT, FK) # Premio que debe completarse antes
- estado (ENUM: bloqueado, activo, completado) DEFAULT 'bloqueado'
- desbloqueado (BOOLEAN) DEFAULT false
- fecha_desbloqueo (DATETIME)
- fecha_completado (DATETIME)
- notas_admin (TEXT)
- timestamps
```

### üìä **Tabla: `niveles`**
```sql
- id (BIGINT, PK)
- premio_id (BIGINT, FK)
- codigo (VARCHAR, 10) # n1, n2, n3, etc.
- titulo (VARCHAR)
- descripcion (TEXT)
- tickets_necesarios (INT) # Tickets necesarios para desbloquear
- valor_aproximado (DECIMAL 12,2) # Valor estimado del nivel
- imagen (VARCHAR)
- media_gallery (JSON) # Im√°genes y videos adicionales
- orden (INT) # Orden dentro del premio (1, 2, 3...)
- desbloqueado (BOOLEAN) DEFAULT false
- es_actual (BOOLEAN) DEFAULT false # Si es el nivel activo actualmente
- fecha_desbloqueo (DATETIME)
- especificaciones (TEXT) # JSON con especificaciones t√©cnicas
- timestamps
```

### üõí **Tabla: `ventas`**
```sql
- id (BIGINT, PK)
- user_id (BIGINT, FK)
- rifa_id (BIGINT, FK)
- codigo_venta (VARCHAR, 20, UNIQUE)
- cantidad_boletos (INT)
- subtotal (DECIMAL 12,2)
- descuento (DECIMAL 12,2) DEFAULT 0
- total (DECIMAL 12,2)
- estado (ENUM: pendiente, pagada, cancelada, expirada) DEFAULT 'pendiente'
- metodo_pago (ENUM: yape, plin, transferencia, efectivo)
- fecha_expiracion (DATETIME) # Para reservas temporales
- notas_cliente (TEXT)
- notas_admin (TEXT)
- comprador_nombre (VARCHAR)
- comprador_email (VARCHAR)
- comprador_telefono (VARCHAR)
- comprador_tipo_documento (ENUM: dni, ce, passport, ruc, otros) DEFAULT 'dni'
- comprador_numero_documento (VARCHAR, 20)
- referencia_pago (VARCHAR)
- fecha_pago (DATETIME)
- monto_pagado (DECIMAL 12,2)
- comprobante_pago (VARCHAR) # URL del comprobante
- timestamps
```

### üé´ **Tabla: `boletos`**
```sql
- id (BIGINT, PK)
- rifa_id (BIGINT, FK)
- user_id (BIGINT, FK)
- venta_id (BIGINT, FK)
- numero (VARCHAR, 10) # N√∫mero del boleto
- precio_pagado (DECIMAL 10,2)
- estado (ENUM: reservado, pagado, cancelado) DEFAULT 'reservado'
- fecha_reserva (DATETIME)
- fecha_expiracion_reserva (DATETIME)
- fecha_pago (DATETIME)
- codigo_verificacion (VARCHAR, 50, UNIQUE)
- es_ganador (BOOLEAN) DEFAULT false
- timestamps
```

### üí≥ **Tabla: `pagos`**
```sql
- id (BIGINT, PK)
- venta_id (BIGINT, FK)
- metodo_pago (VARCHAR) # yape, plin, transferencia, efectivo
- monto (DECIMAL 12,2)
- referencia_externa (VARCHAR) # ID de transacci√≥n del banco/app
- numero_operacion (VARCHAR)
- fecha_transaccion (DATETIME)
- estado (ENUM: pendiente, verificado, rechazado) DEFAULT 'pendiente'
- comprobante_url (VARCHAR) # URL del comprobante subido
- notas_verificacion (TEXT)
- verificado_por (BIGINT, FK) # Admin que verific√≥
- fecha_verificacion (DATETIME)
- datos_pago (JSON) # Datos espec√≠ficos seg√∫n el m√©todo
- timestamps
```

### üè∑Ô∏è **Tabla: `categorias`**
```sql
- id (BIGINT, PK)
- nombre (VARCHAR, 100)
- slug (VARCHAR, 100, UNIQUE)
- descripcion (TEXT)
- icono (VARCHAR, 50)
- color (VARCHAR, 7) DEFAULT '#8B5CF6'
- activa (BOOLEAN) DEFAULT true
- orden (INT) DEFAULT 0
- timestamps
```

### üîß **Tabla: `configuraciones`**
```sql
- id (BIGINT, PK)
- clave (VARCHAR, 100, UNIQUE)
- valor (TEXT)
- tipo (VARCHAR, 50) DEFAULT 'string' # string, number, boolean, json
- grupo (VARCHAR, 50) # general, pagos, notificaciones, etc.
- descripcion (TEXT)
- editable (BOOLEAN) DEFAULT true
- timestamps
```

### üîî **Tabla: `notificaciones`**
```sql
- id (BIGINT, PK)
- user_id (BIGINT, FK)
- titulo (VARCHAR)
- mensaje (TEXT)
- tipo (ENUM: info, success, warning, error) DEFAULT 'info'
- canal (ENUM: sistema, email, sms, whatsapp) DEFAULT 'sistema'
- datos_adicionales (JSON) # Para datos espec√≠ficos como rifa_id, venta_id, etc.
- leida (BOOLEAN) DEFAULT false
- fecha_leida (DATETIME)
- enviada (BOOLEAN) DEFAULT false
- fecha_envio (DATETIME)
- error_envio (TEXT)
- referencia_externa (VARCHAR) # ID del servicio de env√≠o
- timestamps
```

### üìà **Tabla: `progreso_premios`**
```sql
- id (BIGINT, PK)
- premio_id (BIGINT, FK)
- nivel_id (BIGINT, FK) # NULL si es progreso general del premio
- tickets_actuales (INT) DEFAULT 0
- tickets_objetivo (INT)
- porcentaje_completado (DECIMAL 5,2) DEFAULT 0 # 0.00 - 100.00
- objetivo_alcanzado (BOOLEAN) DEFAULT false
- fecha_alcanzado (DATETIME)
- ultimo_ticket (DATETIME) # Fecha del √∫ltimo ticket que contribuy√≥
- tickets_restantes (VIRTUAL) # tickets_objetivo - tickets_actuales
- timestamps
```

### üïµÔ∏è **Tabla: `auditoria`**
```sql
- id (BIGINT, PK)
- tabla_afectada (VARCHAR) # Nombre de la tabla
- accion (VARCHAR) # INSERT, UPDATE, DELETE
- registro_id (BIGINT) # ID del registro afectado
- user_id (BIGINT, FK) # Usuario que realiz√≥ la acci√≥n
- datos_anteriores (JSON) # Datos antes del cambio
- datos_nuevos (JSON) # Datos despu√©s del cambio
- ip_address (VARCHAR, 45) # IP del usuario
- user_agent (VARCHAR) # Navegador del usuario
- observaciones (TEXT) # Comentarios adicionales
- timestamps
```

## üèóÔ∏è Arquitectura del Sistema

### **Frontend (Vue.js 3)**
```
frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/          # Componentes reutilizables
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppHeader.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppFooter.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MediaGallery.vue
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProgressBar.vue
‚îÇ   ‚îú‚îÄ‚îÄ views/               # P√°ginas principales
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Home.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RifaDetail.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PremioDetail.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.vue
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Login.vue
‚îÇ   ‚îú‚îÄ‚îÄ composables/         # L√≥gica reutilizable
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useRifaDetail.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useAuth.js
‚îÇ   ‚îú‚îÄ‚îÄ services/            # Servicios API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rifaService.js
‚îÇ   ‚îú‚îÄ‚îÄ store/               # Estado global
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.js
‚îÇ   ‚îú‚îÄ‚îÄ router/              # Configuraci√≥n de rutas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.js
‚îÇ   ‚îî‚îÄ‚îÄ utils/               # Utilidades
‚îÇ       ‚îî‚îÄ‚îÄ helpers.js
```

### **Backend (Laravel 12)**
```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ Http/Controllers/    # Controladores API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RifaController.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PremioController.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VentaController.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthController.php
‚îÇ   ‚îú‚îÄ‚îÄ Models/              # Modelos Eloquent
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Rifa.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Premio.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Nivel.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Venta.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Boleto.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ User.php
‚îÇ   ‚îú‚îÄ‚îÄ Services/            # L√≥gica de negocio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RifaService.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PagoService.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NotificationService.php
‚îÇ   ‚îî‚îÄ‚îÄ Observers/           # Observadores para auditor√≠a
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ migrations/          # Migraciones de BD
‚îÇ   ‚îî‚îÄ‚îÄ seeders/             # Datos iniciales
‚îî‚îÄ‚îÄ routes/
    ‚îî‚îÄ‚îÄ api.php              # Rutas API
```

## ÔøΩ Flujo del Sistema de Premios Progresivos

### **1. Configuraci√≥n de Rifa**
```mermaid
graph TD
    A[Crear Rifa] --> B[Definir Premios]
    B --> C[Configurar Niveles por Premio]
    C --> D[Establecer Tickets Necesarios]
    D --> E[Activar Rifa]
```

### **2. Proceso de Venta**
```mermaid
graph TD
    A[Usuario Compra Ticket] --> B[Se Incrementa boletos_vendidos]
    B --> C[Verificar Niveles Desbloqueados]
    C --> D[Actualizar Estado Premios]
    D --> E[Notificar Usuarios]
```

### **3. Estados de Premio**
- **Bloqueado**: No se han vendido suficientes tickets
- **Activo**: Tickets suficientes para el nivel actual
- **Completado**: Todos los niveles completados

## üöÄ Funcionalidades Implementadas

### **Frontend (Vue.js 3)**
- ‚úÖ **Home**: Vista principal con rifas activas y futuras
- ‚úÖ **RifaDetail**: Detalle de rifa con premios progresivos
- ‚úÖ **PremioDetail**: Vista individual de cada premio
- ‚úÖ **MediaGallery**: Galer√≠a multimedia responsiva
- ‚úÖ **Sistema de Pagos**: Integraci√≥n con Yape/Plin
- ‚úÖ **Autenticaci√≥n**: Login/Register con persistencia
- ‚úÖ **Dashboard**: Panel de usuario con historial
- ‚úÖ **Admin Panel**: Panel administrativo completo
- ‚úÖ **Responsive Design**: Optimizado para m√≥viles

### **Backend (Laravel 12)**
- ‚úÖ **API REST**: Endpoints para todas las funcionalidades
- ‚úÖ **Autenticaci√≥n**: Laravel Sanctum con JWT
- ‚úÖ **Sistema de Premios**: L√≥gica de desbloqueo progresivo
- ‚úÖ **Gesti√≥n de Pagos**: Verificaci√≥n y procesamiento
- ‚úÖ **Dashboard Admin**: Panel administrativo completo
- ‚úÖ **Gesti√≥n de Rifas**: CRUD completo con validaciones
- ‚úÖ **Gesti√≥n de Usuarios**: Control de roles y permisos
- ‚úÖ **Reportes y Estad√≠sticas**: Analytics en tiempo real
- ‚úÖ **Upload de Archivos**: Gesti√≥n de im√°genes y medios
- ‚úÖ **Auditor√≠a**: Registro de todas las acciones

## üöÄ API Endpoints

### **Base URL**: `http://localhost:8000/api/v1`

### üîì **Endpoints P√∫blicos**

#### **Autenticaci√≥n**
```http
POST /auth/register          # Registro de usuario
POST /auth/login             # Iniciar sesi√≥n
```

**Ejemplo de registro:**
```json
POST /api/v1/auth/register
{
  "name": "Juan P√©rez",
  "email": "juan@email.com",
  "password": "12345678",
  "password_confirmation": "12345678",
  "telefono": "+51987654321",
  "tipo_documento": "dni",
  "numero_documento": "12345678",
  "fecha_nacimiento": "1990-01-01",
  "genero": "masculino"
}
```

**Respuesta:**
```json
{
  "success": true,
  "message": "Usuario registrado correctamente",
  "data": {
    "user": {
      "id": 1,
      "name": "Juan P√©rez",
      "email": "juan@email.com",
      "telefono": "+51987654321",
      "tipo_documento": "dni",
      "numero_documento": "12345678",
      "rol": "usuario",
      "activo": true
    },
    "token": "1|abc123..."
  }
}
```

**Ejemplo de login:**
```json
POST /api/v1/auth/login
{
  "email": "juan@email.com",
  "password": "12345678"
}
```

**Respuesta:**
```json
{
  "success": true,
  "message": "Login exitoso",
  "data": {
    "user": { ... },
    "token": "1|xyz789..."
  }
}
```

#### **Rifas**
```http
GET /rifas                   # Listar todas las rifas
GET /rifas/actuales         # Rifas en venta
GET /rifas/futuras          # Rifas por venir  
GET /rifas/destacadas       # Rifas destacadas
GET /rifas/{codigo}         # Detalle de rifa
GET /rifas/{codigo}/progreso # Progreso de premios
```

**Par√°metros de consulta:**
- `categoria_id`: Filtrar por categor√≠a
- `tipo`: `actual` o `futura`
- `estado`: `activa`, `borrador`, `pausada`, `finalizada`, `cancelada`
- `destacadas`: `true` para rifas destacadas
- `per_page`: N√∫mero de resultados por p√°gina (default: 15)

**Ejemplo:**
```http
GET /api/v1/rifas/actuales?categoria_id=1&per_page=10
```

**Respuesta:**
```json
{
  "success": true,
  "data": {
    "current_page": 1,
    "data": [
      {
        "id": 1,
        "titulo": "iPhone 15 Pro Max",
        "codigo_unico": "IPHONE15PM001",
        "precio_boleto": "10.00",
        "boletos_vendidos": 35,
        "boletos_minimos": 100,
        "boletos_maximos": null,
        "porcentaje_completado": 35.0,
        "estado": "activa",
        "tipo": "actual",
        "categoria": {
          "id": 1,
          "nombre": "Tecnolog√≠a",
          "slug": "tecnologia"
        },
        "premios": [
          {
            "id": 1,
            "codigo": "p1",
            "titulo": "AirPods Pro",
            "estado": "activo",
            "niveles": [
              {
                "id": 1,
                "codigo": "n1",
                "titulo": "AirPods Pro 2da Gen",
                "tickets_necesarios": 20,
                "desbloqueado": true,
                "es_actual": false
              }
            ]
          }
        ]
      }
    ],
    "total": 5,
    "per_page": 10,
    "current_page": 1,
    "last_page": 1
  }
}
```

#### **Categor√≠as**
```http
GET /categorias             # Listar categor√≠as activas
```

**Respuesta:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "nombre": "Tecnolog√≠a",
      "slug": "tecnologia",
      "descripcion": "Productos tecnol√≥gicos y gadgets",
      "icono": "fas fa-laptop",
      "color": "#3B82F6",
      "rifas_count": 5
    }
  ]
}
```

#### **Premios**
```http
GET /premios/{rifaCodigoUnico}/{codigoPremio} # Detalle del premio
```

#### **Consulta de Ventas**
```http
GET /ventas/{codigo}        # Consultar venta por c√≥digo
```

### üîê **Endpoints Autenticados**
*Requieren header: `Authorization: Bearer {token}`*

#### **Perfil de Usuario**
```http
POST /auth/logout           # Cerrar sesi√≥n
GET /auth/profile          # Obtener perfil
PUT /auth/profile          # Actualizar perfil
```

**Ejemplo actualizar perfil:**
```json
PUT /api/v1/auth/profile
{
  "name": "Juan Carlos P√©rez",
  "telefono": "+51987654321",
  "direccion": "Av. Lima 123",
  "ciudad": "Lima",
  "departamento": "Lima"
}
```

#### **Ventas**
```http
POST /ventas               # Crear nueva venta (reservar boletos)
POST /ventas/{codigo}/confirmar-pago # Subir comprobante
GET /ventas/mis-ventas     # Mis compras
```

**Ejemplo de compra:**
```json
POST /api/v1/ventas
{
  "rifa_codigo": "IPHONE15PM001",
  "numeros_boletos": ["0001", "0025", "0100"],
  "comprador_nombre": "Juan P√©rez",
  "comprador_email": "juan@email.com", 
  "comprador_telefono": "+51987654321",
  "comprador_tipo_documento": "dni",
  "comprador_numero_documento": "12345678",
  "metodo_pago": "yape"
}
```

**Respuesta:**
```json
{
  "success": true,
  "message": "Venta creada correctamente",
  "data": {
    "codigo_venta": "VT20250801ABC123",
    "total": "30.00",
    "fecha_expiracion": "2025-08-01T10:15:00Z",
    "boletos": [
      {
        "numero": "0001",
        "codigo_verificacion": "A1B2C3D4E5"
      },
      {
        "numero": "0025",
        "codigo_verificacion": "B2C3D4E5F6"
      },
      {
        "numero": "0100",
        "codigo_verificacion": "C3D4E5F6G7"
      }
    ],
    "tiempo_restante": 900
  }
}
```

**Confirmar pago:**
```http
POST /api/v1/ventas/VT20250801ABC123/confirmar-pago
Content-Type: multipart/form-data

numero_operacion: "123456789"
monto_pagado: "30.00"
comprobante: [archivo imagen]
```

### üîß **Endpoints Administrativos**
*Requieren autenticaci√≥n + rol admin*

#### **Dashboard Admin**
```http
GET /admin/dashboard/stats     # Estad√≠sticas generales
GET /admin/activity/recent     # Actividad reciente
```

#### **Gesti√≥n de Rifas**
```http
GET /admin/rifas              # Lista para admin
POST /admin/rifas             # Crear rifa
PUT /admin/rifas/{id}         # Actualizar rifa
DELETE /admin/rifas/{id}      # Eliminar rifa
PATCH /admin/rifas/{id}/estado # Cambiar estado
GET /admin/rifas/exportar     # Exportar datos
```

#### **Gesti√≥n de Usuarios**
```http
GET /admin/usuarios           # Lista usuarios
POST /admin/usuarios          # Crear usuario
PUT /admin/usuarios/{id}      # Actualizar usuario
DELETE /admin/usuarios/{id}   # Eliminar usuario
```

#### **Reportes y Ventas**
```http
GET /admin/ventas             # Lista ventas
GET /admin/ventas/reportes    # Reportes de ventas
```

#### **Upload de Archivos**
```http
POST /upload/rifa-image       # Subir imagen de rifa
POST /upload/premio-image     # Subir imagen de premio
POST /upload/nivel-image      # Subir imagen de nivel
DELETE /upload/image          # Eliminar imagen
```

### üìä **C√≥digos de Respuesta**

- `200` - OK: Operaci√≥n exitosa
- `201` - Created: Recurso creado
- `401` - Unauthorized: Token inv√°lido o expirado
- `403` - Forbidden: Sin permisos
- `404` - Not Found: Recurso no encontrado
- `409` - Conflict: N√∫meros ya ocupados
- `410` - Gone: Venta expirada
- `422` - Validation Error: Datos incorrectos
- `500` - Server Error: Error interno

### üîí **Autenticaci√≥n**

El sistema usa **Laravel Sanctum** para autenticaci√≥n API:

1. **Registro/Login** ‚Üí Recibir token
2. **Incluir en headers**: `Authorization: Bearer {token}`
3. **Token expira** cuando el usuario hace logout

### ‚ö° **Caracter√≠sticas Avanzadas**

- **Reserva temporal**: N√∫meros reservados por 15 minutos
- **Verificaci√≥n en tiempo real**: Disponibilidad de n√∫meros
- **Upload de archivos**: Comprobantes de pago e im√°genes
- **Paginaci√≥n autom√°tica**: En listados
- **Filtros avanzados**: Por categor√≠a, estado, etc.
- **Relaciones optimizadas**: Carga eager loading
- **Validaciones robustas**: En todos los endpoints
- **Panel Admin Completo**: Gesti√≥n total del sistema
- **Reportes en Tiempo Real**: Analytics y estad√≠sticas
- **Sistema de Roles**: Control de permisos granular
- **Middleware de Seguridad**: Protecci√≥n de rutas admin
- **Estados de Rifa**: Borrador, activa, bloqueada, pausada, finalizada, cancelada
- **Gesti√≥n de Media**: Upload y organizaci√≥n de im√°genes/videos

### **Frontend Implementado**
- ‚úÖ **Autenticaci√≥n**: Login/Register con persistencia
- ‚úÖ **Dashboard**: Panel de usuario con historial
- ‚úÖ **Panel Admin**: Gesti√≥n completa de rifas y usuarios
- ‚úÖ **Responsive Design**: Optimizado para m√≥viles
- ‚úÖ **Router Guards**: Protecci√≥n de rutas
- ‚úÖ **State Management**: Manejo de estado global
- ‚úÖ **Error Handling**: Manejo de errores avanzado

### **Backend Avanzado**
- ‚úÖ **API REST**: Endpoints para todas las funcionalidades
- ‚úÖ **Sistema de Premios**: L√≥gica de desbloqueo progresivo
- ‚úÖ **Gesti√≥n de Pagos**: Verificaci√≥n y procesamiento
- ‚úÖ **Notificaciones**: Email, SMS y WhatsApp (preparado)
- ‚úÖ **Auditor√≠a**: Registro de todas las acciones
- ‚úÖ **Dashboard Admin**: Panel administrativo completo
- ‚úÖ **Middleware Personalizado**: AdminMiddleware para seguridad
- ‚úÖ **Validaciones Avanzadas**: Request validation en todos los endpoints
- ‚úÖ **Manejo de Estados**: Estados complejos de rifas y premios

## üîê Seguridad y Validaciones

### **Frontend**
- Validaci√≥n de formularios con Vue 3
- Sanitizaci√≥n de datos de entrada
- Control de acceso por roles
- Persistencia segura en localStorage

### **Backend**
- Validaci√≥n de datos con Laravel Request
- Middleware de autenticaci√≥n JWT
- Rate limiting en APIs
- Auditor√≠a completa de acciones
- Encriptaci√≥n de datos sensibles

## üì± Responsive Design

El sistema est√° optimizado para:
- **Desktop**: 1200px+ (Grid 2fr 1fr)
- **Tablet**: 769px-1199px (Grid compacto)
- **Mobile**: ‚â§768px (Layout en columna √∫nica)

## üöÄ Instalaci√≥n y Configuraci√≥n

### Pre-requisitos
- **Docker Desktop** (Windows/Mac/Linux)
- **Docker Compose** v2.0+
- **Git** para clonar el repositorio
- **4GB RAM m√≠nimo** para los contenedores
- **Puertos disponibles**: 3000 (Frontend), 8000 (Backend), 3306 (MySQL)

### üîß Configuraci√≥n Inicial

1. **Clonar el repositorio:**
```bash
git clone https://github.com/TheDanilore/danilore-rifas.git
cd danilore-rifas
```

2. **Configurar variables de entorno (backend):**
```bash
# Navegar al directorio backend
cd backend

# Copiar el archivo de configuraci√≥n
cp .env.example .env

# Editar el archivo .env con tu configuraci√≥n
# Las variables importantes ya est√°n configuradas para Docker
```

**Variables de entorno clave en `.env`:**
```env
APP_NAME="Danilore Rifas"
APP_ENV=local
APP_KEY=base64:... # Se genera autom√°ticamente
APP_DEBUG=true
APP_URL=http://localhost:8000

DB_CONNECTION=mysql
DB_HOST=mysql
DB_PORT=3306
DB_DATABASE=danilore_rifas
DB_USERNAME=danilore
DB_PASSWORD=danilore123

# Laravel Sanctum para autenticaci√≥n
SANCTUM_STATEFUL_DOMAINS=localhost:3000,127.0.0.1:3000
SESSION_DOMAIN=localhost

# Configuraci√≥n de archivos
FILESYSTEM_DISK=local
```

3. **Construir y levantar los servicios:**
```bash
# Volver al directorio ra√≠z
cd ..

# Construir y levantar todos los servicios
docker-compose up --build -d
```

4. **Instalar dependencias del backend:**
```bash
# Instalar dependencias de Composer
docker exec danilore_backend composer install

# Generar clave de la aplicaci√≥n
docker exec danilore_backend php artisan key:generate

# Generar enlace simb√≥lico para storage
docker exec danilore_backend php artisan storage:link
```

5. **Configurar la base de datos:**
```bash
# Ejecutar migraciones
docker exec danilore_backend php artisan migrate

# Ejecutar seeders (datos de prueba)
docker exec danilore_backend php artisan db:seed
```

6. **Configurar el frontend:**
```bash
# Instalar dependencias de Node.js
docker exec danilore_frontend npm install

# Compilar assets para desarrollo
docker exec danilore_frontend npm run serve
```

### üìä Servicios Disponibles

| Servicio | Puerto | URL | Descripci√≥n |
|----------|--------|-----|-------------|
| **Frontend** (Vue.js) | 3000 | http://localhost:3000 | Aplicaci√≥n web principal |
| **Backend** (Laravel) | 8000 | http://localhost:8000 | API REST y admin |
| **MySQL** | 3306 | localhost:3306 | Base de datos |
| **PHPMyAdmin** | 8080 | http://localhost:8080 | Administrador de BD |

### üóÑÔ∏è Acceso a la Base de Datos

#### **Credenciales MySQL:**
- **Host:** localhost (desde host) / mysql (desde contenedores)
- **Puerto:** 3306
- **Base de datos:** danilore_rifas
- **Usuario:** danilore
- **Contrase√±a:** danilore123
- **Root Password:** root123

#### **PHPMyAdmin (Opcional):**
Si quieres acceso visual a la base de datos, puedes agregar PHPMyAdmin al `docker-compose.yml`:

```yaml
phpmyadmin:
  image: phpmyadmin/phpmyadmin
  container_name: danilore_phpmyadmin
  environment:
    PMA_HOST: mysql
    PMA_USER: danilore
    PMA_PASSWORD: danilore123
  ports:
    - "8080:80"
  depends_on:
    - mysql
  networks:
    - danilore_network
```

### üõ†Ô∏è Comandos √ötiles

#### **Docker Management**
```bash
# Levantar servicios
docker-compose up -d

# Ver logs en tiempo real
docker-compose logs -f

# Ver logs de un servicio espec√≠fico
docker-compose logs -f backend

# Detener servicios
docker-compose down

# Reconstruir contenedores (despu√©s de cambios)
docker-compose up --build -d

# Limpiar vol√∫menes (CUIDADO: borra la BD)
docker-compose down -v
```

#### **Laravel (Backend)**
```bash
# Ejecutar comandos artisan
docker exec danilore_backend php artisan migrate
docker exec danilore_backend php artisan db:seed
docker exec danilore_backend php artisan cache:clear
docker exec danilore_backend php artisan config:clear
docker exec danilore_backend php artisan route:clear

# Crear migraciones
docker exec danilore_backend php artisan make:migration create_nueva_tabla

# Crear controladores
docker exec danilore_backend php artisan make:controller NuevoController

# Acceder al contenedor
docker exec -it danilore_backend bash

# Ver rutas API
docker exec danilore_backend php artisan route:list --path=api
```

#### **Vue.js (Frontend)**
```bash
# Instalar nuevas dependencias
docker exec danilore_frontend npm install paquete-nuevo

# Ejecutar en modo desarrollo con hot-reload
docker exec danilore_frontend npm run serve

# Compilar para producci√≥n
docker exec danilore_frontend npm run build

# Linting de c√≥digo
docker exec danilore_frontend npm run lint

# Acceder al contenedor
docker exec -it danilore_frontend sh
```

#### **Base de Datos**
```bash
# Conectar a MySQL desde l√≠nea de comandos
docker exec -it danilore_mysql mysql -u danilore -p danilore_rifas

# Hacer backup de la base de datos
docker exec danilore_mysql mysqldump -u danilore -p danilore_rifas > backup.sql

# Restaurar backup
docker exec -i danilore_mysql mysql -u danilore -p danilore_rifas < backup.sql

# Ver logs de MySQL
docker logs danilore_mysql
```

### üîç Verificaci√≥n de la Instalaci√≥n

1. **Verificar que todos los servicios est√©n corriendo:**
```bash
docker-compose ps
```

2. **Probar el backend:**
```bash
curl http://localhost:8000/api/v1/categorias
```

3. **Acceder al frontend:**
Abrir http://localhost:3000 en el navegador

4. **Probar autenticaci√≥n:**
- Registrar nuevo usuario en http://localhost:3000/register
- Hacer login en http://localhost:3000/login
- Acceder al admin en http://localhost:3000/admin (user: admin@danilore.com, pass: admin123)

### üêõ Soluci√≥n de Problemas

#### **Puerto ya en uso:**
```bash
# Verificar qu√© usa el puerto
netstat -ano | findstr :3000
netstat -ano | findstr :8000

# Cambiar puertos en docker-compose.yml si es necesario
```

#### **Problemas de permisos (Linux/Mac):**
```bash
# Dar permisos a los directorios de Laravel
sudo chown -R $USER:$USER backend/storage
sudo chown -R $USER:$USER backend/bootstrap/cache
```

#### **Limpiar cache de Docker:**
```bash
docker system prune -a
docker volume prune
```

#### **Reiniciar base de datos:**
```bash
# Detener servicios
docker-compose down

# Eliminar volumen de la base de datos
docker volume rm danilore-rifas_mysql_data

# Levantar servicios y ejecutar migraciones
docker-compose up -d
docker exec danilore_backend php artisan migrate
docker exec danilore_backend php artisan db:seed
```

### üì± Modo Desarrollo vs Producci√≥n

#### **Desarrollo (Actual):**
- Hot-reload habilitado
- Debug mode activado
- CORS configurado para localhost
- Logs detallados

#### **Para Producci√≥n:**
```bash
# Backend
APP_ENV=production
APP_DEBUG=false

# Frontend
npm run build

# Configurar dominio real y SSL
```


### ÔøΩ **Credenciales por Defecto**

#### **Base de Datos MySQL:**
- **Host:** localhost:3306 (desde host) / mysql:3306 (desde contenedores)
- **Database:** danilore_rifas
- **Usuario:** danilore
- **Contrase√±a:** danilore123
- **Root Password:** root123

#### **Usuario Admin por Defecto:**
- **Email:** admin@danilore.com
- **Contrase√±a:** admin123
- **Rol:** Administrador
- **Acceso:** http://localhost:3000/admin

#### **Usuario de Prueba:**
- **Email:** usuario@test.com
- **Contrase√±a:** 12345678
- **Rol:** Usuario regular

## üéØ API Endpoints Completos (Backend)

### **Base URL**: `http://localhost:8000/api/v1`

### **üîì Rutas P√∫blicas**
```
POST   /auth/register                    # Registro de usuario
POST   /auth/login                       # Iniciar sesi√≥n

GET    /rifas                           # Listar todas las rifas
GET    /rifas/actuales                  # Rifas activas
GET    /rifas/futuras                   # Rifas futuras
GET    /rifas/destacadas                # Rifas destacadas
GET    /rifas/{codigo}                  # Detalle de rifa
GET    /rifas/{codigo}/progreso         # Progreso de premios

GET    /categorias                      # Listar categor√≠as activas
GET    /premios/{rifaCode}/{premioCode} # Detalle de premio espec√≠fico
GET    /ventas/{codigo}                 # Consultar venta por c√≥digo
```

### **üîê Rutas Autenticadas** (Requieren `Authorization: Bearer {token}`)
```
POST   /auth/logout                     # Cerrar sesi√≥n
GET    /auth/profile                    # Obtener perfil
PUT    /auth/profile                    # Actualizar perfil

POST   /ventas                          # Crear nueva venta
POST   /ventas/{codigo}/confirmar-pago  # Confirmar pago con comprobante
GET    /ventas/mis-ventas               # Historial de compras

POST   /upload/rifa-image               # Subir imagen de rifa
POST   /upload/premio-image             # Subir imagen de premio
POST   /upload/nivel-image              # Subir imagen de nivel
DELETE /upload/image                    # Eliminar imagen
```

### **üëë Rutas de Administraci√≥n** (Requieren autenticaci√≥n + rol admin)
```
# Dashboard y Estad√≠sticas
GET    /admin/dashboard/stats           # Estad√≠sticas del dashboard
GET    /admin/activity/recent           # Actividad reciente

# Gesti√≥n de Rifas
GET    /admin/rifas                     # Lista rifas para admin
POST   /admin/rifas                     # Crear nueva rifa
PUT    /admin/rifas/{id}               # Actualizar rifa
DELETE /admin/rifas/{id}               # Eliminar rifa
PATCH  /admin/rifas/{id}/estado        # Cambiar estado de rifa
GET    /admin/rifas/estadisticas       # Estad√≠sticas de rifas
GET    /admin/rifas/exportar           # Exportar datos de rifas

# Gesti√≥n de Usuarios
GET    /admin/usuarios                  # Lista usuarios
POST   /admin/usuarios                  # Crear nuevo usuario
PUT    /admin/usuarios/{id}            # Actualizar usuario
DELETE /admin/usuarios/{id}            # Eliminar usuario

# Reportes y Ventas
GET    /admin/ventas                    # Lista ventas
GET    /admin/ventas/reportes          # Reportes de ventas

# Gesti√≥n de Media
POST   /media/premios/{id}/images       # Subir imagen de premio
DELETE /media/premios/{id}/images       # Eliminar imagen de premio
GET    /media/premios/{id}/images       # Obtener im√°genes de premio
PUT    /media/premios/{id}/images/reorder # Reordenar im√°genes
```

### **üîß Informaci√≥n Adicional**
- **Middleware de Admin**: `AdminMiddleware` verifica rol y estado activo
- **Rate Limiting**: Configurado en rutas sensibles
- **CORS**: Habilitado para localhost:3000
- **Validaci√≥n**: Request validation en todos los endpoints
- **Paginaci√≥n**: Implementada en listados (default: 15 items)
- **Eager Loading**: Optimizaci√≥n de consultas con relaciones

### **‚ö†Ô∏è Puntos de Atenci√≥n**
- Los enums deben mantenerse sincronizados entre frontend y backend
- Las validaciones JavaScript deben coincidir con las de Laravel
- Los nombres de campos JSON deben ser consistentes
- Los c√≥digos de premio/nivel deben seguir la convenci√≥n establecida

## üöÄ Producci√≥n

### **Configuraci√≥n para Producci√≥n**

#### **Variables de Entorno (.env)**
```env
APP_ENV=production
APP_DEBUG=false
APP_URL=https://tudomain.com

# Base de datos de producci√≥n
DB_HOST=tu-servidor-mysql
DB_DATABASE=danilore_rifas_prod
DB_USERNAME=usuario_prod
DB_PASSWORD=contrase√±a_segura

# Configurar CORS para dominio real
SANCTUM_STATEFUL_DOMAINS=tudomain.com

# SSL y seguridad
FORCE_HTTPS=true
SESSION_SECURE_COOKIE=true
```

#### **Frontend para Producci√≥n**
```bash
# Compilar assets optimizados
docker exec danilore_frontend npm run build

# Configurar URL de API para producci√≥n
# Editar frontend/src/config/backend.js
```

#### **Optimizaciones Recomendadas**
- **CDN**: Para im√°genes y assets est√°ticos
- **Redis**: Para cache y sesiones
- **SSL/TLS**: Certificado HTTPS obligatorio
- **Backup Autom√°tico**: Base de datos
- **Monitoring**: Logs y m√©tricas
- **Load Balancer**: Para alta disponibilidad

#### **Docker Compose para Producci√≥n**
```yaml
# Usar im√°genes optimizadas
# Configurar vol√∫menes persistentes
# Habilitar restart policies
# Configurar networks seguros
```

### **üîí Seguridad Implementada**

- **Laravel Sanctum**: Autenticaci√≥n API segura
- **Middleware AdminMiddleware**: Control de acceso administrativo
- **Validaci√≥n robusta**: En todos los endpoints
- **Hash de contrase√±as**: Bcrypt
- **CORS configurado**: Solo dominios permitidos
- **Rate limiting**: Protecci√≥n contra ataques
- **SQL Injection**: Protecci√≥n con Eloquent ORM
- **XSS Protection**: Sanitizaci√≥n de datos

---

**Desarrollado para Danilore Rifas** üé≤

- **Desarrollador**: The Danilore
- **Email**: arteagagordillol@gmail.com
- **Versi√≥n**: 2.0.0
- **√öltima actualizaci√≥n**: Agosto 2025